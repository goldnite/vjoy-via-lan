<html>
  <head>
    <title>Express</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>

  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const keymap = {
        X: 'KeyA', // kick
        A: 'KeyS', // pass
        B: 'KeyD', // loft pass
        Y: 'KeyW', // through pass
        LT: 'KeyZ',
        RT: 'KeyC',
        LB: 'KeyQ',
        RB: 'KeyE',
        ESC: 'KeyR',
        MENU: 'KeyB',
        LS: 'Digit1',
        RS: 'Digit2',
        LSU: 'KeyI',
        LSL: 'KeyJ',
        LSD: 'KeyK',
        LSR: 'KeyL',
        RSU: 'KeyT',
        RSL: 'KeyF',
        RSD: 'KeyV',
        RSR: 'KeyG',
        U: 'ArrowUp',
        L: 'ArrowLeft',
        D: 'ArrowDown',
        R: 'ArrowRight',
      };
      function MyApp() {
        useEffect(() => {});
        return <h1></h1>;
      }

      const container = document.getElementById('root');
      const root = ReactDOM.createRoot(container);
      root.render(<MyApp />);
      let ws;
      addEventListener('keydown', (e) => {
        if (!e.repeat) {
          Object.keys(keymap).forEach((v) => {
            if (e.code == keymap[v]) {
              ws.send(
                JSON.stringify({
                  k: v,
                  v: 1,
                })
              );
            }
          });
        }
      });
      addEventListener('keyup', (e) => {
        Object.keys(keymap).forEach((v) => {
          if (e.code == keymap[v]) {
            ws.send(
              JSON.stringify({
                k: v,
                v: 0,
              })
            );
          }
        });
      });
      function connect() {
        ws = new WebSocket('ws://10.10.15.170:3001');
        ws.onopen = function (evt) {
          console.log('connected to server');
        };
        ws.onmessage = function (evt) {
          console.log(`data from server: ${evt.data}`);
        };
        ws.onclose = function () {
          console.log('try reconnecting');
          connect();
        };
      }
      connect();
    </script>
  </body>
</html>
