<html>
  <head>
    <title>Express</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <script src="/scripts/react.development.js"></script>
    <script src="/scripts/react-dom.development.js"></script>
    <script src="/scripts/babel.min.js"></script>
  </head>

  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const defaultKeyMap = {
        X: 'KeyA', // kick
        A: 'KeyX', // pass
        B: 'KeyD', // loft pass
        Y: 'KeyW', // through pass
        LT: 'KeyZ',
        RT: 'KeyC',
        LB: 'KeyQ',
        RB: 'KeyE',
        ESC: 'KeyV',
        MENU: 'KeyB',
        LS: '',
        RS: '',
        LSU: 'ArrowUp',
        LSL: 'ArrowLeft',
        LSD: 'ArrowDown',
        LSR: 'ArrowRight',
        RSU: '',
        RSL: '',
        RSD: '',
        RSR: '',
        U: 'Numpad8',
        L: 'Numpad4',
        D: 'Numpad2',
        R: 'Numpad6',
      };
      const keymap = {
        X: 'KeyA', // kick
        A: 'KeyS', // pass
        B: 'KeyD', // loft pass
        Y: 'KeyW', // through pass
        LT: 'KeyZ',
        RT: 'KeyC',
        LB: 'KeyQ',
        RB: 'KeyE',
        ESC: 'KeyR',
        MENU: 'KeyB',
        LS: 'Digit1',
        RS: 'Digit2',
        LSU: 'KeyI',
        LSL: 'KeyJ',
        LSD: 'KeyK',
        LSR: 'KeyL',
        RSU: 'KeyT',
        RSL: 'KeyF',
        RSD: 'KeyV',
        RSR: 'KeyG',
        U: 'ArrowUp',
        L: 'ArrowLeft',
        D: 'ArrowDown',
        R: 'ArrowRight',
      };

      let ws;
      addEventListener('keydown', (e) => {
        if (!e.repeat) {
          console.log('e.code :>> ', e.code);
          Object.keys(keymap).forEach((v) => {
            if (e.code == keymap[v]) {
              ws.send(
                JSON.stringify({
                  k: v,
                  v: 1,
                })
              );
            }
          });
        }
      });
      addEventListener('keyup', (e) => {
        Object.keys(keymap).forEach((v) => {
          if (e.code == keymap[v]) {
            ws.send(
              JSON.stringify({
                k: v,
                v: 0,
              })
            );
          }
        });
      });
      function connect() {
        ws = new WebSocket('ws://10.10.15.170:3001');
        ws.onopen = function (evt) {
          console.log('connected to server');
        };
        ws.onmessage = function (evt) {
          console.log(`data from server: ${evt.data}`);
        };
        ws.onclose = function () {
          console.log('try reconnecting');
          connect();
        };
      }
      connect();

      function MyApp() {
        const leftButtons = [
          'LT',
          'LB',
          'U',
          'L',
          'D',
          'R',
          'LSU',
          'LSL',
          'LSD',
          'LSR',
          'LS',
          'MENU',
        ];
        const rightButtons = [
          'RT',
          'RB',
          'Y',
          'X',
          'A',
          'B',
          'RSU',
          'RSL',
          'RSD',
          'RSR',
          'RS',
          'ESC',
        ];
        const [waitFor, setWaitFor] = useState('');
        useEffect(() => {});
        return (
          <div>
            <div className='rowContainer'>
              <div className='columnContainer'>
                {leftButtons.map((item, index) => (
                  <div className='rowContainer' key={index}>
                    <img src={`/images/${item}.png`} alt={item} />
                    <button
                      className='keyButton'
                      onClick={(e) => {
                        setWaitFor(item);
                      }}
                    >
                      {waitFor == item
                        ? 'Press the key'
                        : keymap[item]
                            .replace('Key', '')
                            .replace('Arrow', '')
                            .replace('Digit', '')}
                    </button>
                  </div>
                ))}
              </div>
              <div
                className='columnContainer'
                style={{ margin: '20px', gap: '50px' }}
              >
                <img src='/images/joystick.png' alt='joystick' />
                <button
                  style={{
                    width: '300px',
                    height: '30px',
                    backgroundColor: '#e1e1e1',
                    border: '1px #adadad solid',
                  }}
                >
                  Revert to Default Settings
                </button>
              </div>
              <div className='columnContainer'>
                {rightButtons.map((item, index) => (
                  <div className='rowContainer' key={index}>
                    <img src={`/images/${item}.png`} alt={item} />
                    <button className='keyButton'>
                      {keymap[item]
                        .replace('Key', '')
                        .replace('Arrow', '')
                        .replace('Digit', '')}
                    </button>
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      }
      const container = document.getElementById('root');
      const root = ReactDOM.createRoot(container);
      root.render(<MyApp />);
    </script>
    <style>
      .rowContainer {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        gap: 6px;
      }
      .columnContainer {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 6px;
      }
      .keyButton {
        width: 100px;
        height: 20px;
        background-color: #e1e1e1;
        border: 1px #adadad solid;
      }
      button:active {
        border-color: skyblue;
      }
    </style>
  </body>
</html>
